### OLTP

联机事务处理。（大部分）



### OLAP

后台做数据分析



### SQL包括

DOL：查询语言，select

DML：插入，更新，删除

DDL：数据定义语言，创表，修改表，删除表

DCL：数据控制语言：授权，收回用户权限

TCL：事务控制语言：commit rollback



mysql架构：

- 不同语言的协议接口。

- mysql的连接池，使用的是select io多路复用来处理连接。（为什么不用epoll，因为连接数不多，且基本都是活跃fd，而且select跨平台）

accept到新连接，就开一个线程去处理。

每个线程，都循环使用阻塞read，等拿到数据再执行命令，当然也包括权限验证的过程。



- sql接口，语法树
- 进行权限过滤
- 优化器，执行计划

- 缓存组件，lru：利用率很低，后续就取消了
- 存储引擎：innodb
- 文件系统



### 数据库范式

一范式：主键不可分解

二范式：每个字段都依赖于主键，而不是（组合索引主键）的其中一部分

三范式：每个字段都和主键直接相关，而不是间接相关



### CURD

is null、is not null:判空

不等于<>

like：模糊查询



聚合查询：sum avg max min count



group_concat()：分组查询的时候，如果group by的字段和其他字段是一对多（行）的关系，使用concat则可以把多个行的数据连接在一起。

- concat内部连接的时候，可以使用distinct去重后再连接

distinct

order by



### 连表查询

内连接：只保留两张表有对应记录的关系

左链接：保留左表没有对应关系的数据

右连接

外连接：保留所有记录，哪怕没有对应关系



### 子查询



### 视图

可以复用，减少重复查询语句的书写

重构利器，因为某种需求，需要将一个表拆成两个表

逻辑更清晰，屏蔽查询细节

权限控制，真实表对用户屏蔽，而是提供一个视图，这样没有dml的权利，但是有dol的权限



### 索引

- 主键索引：唯一，不能为null  primarykey
- 唯一索引：和主键的区别在于可以为null   unique
- 普通索引:  允许相同的索引内容，不用唯一   
- 组合索引：多个列的组合索引，key也不用唯一，可以放在红黑树的右子树



主键选择：如果没有显式设置，则会选择第一个非空的unique索引作为主键

如果没有非空唯一索引，则会自动生成一个6字节的rowid作为主键



myisam引擎不支持外键，只起注释作用，但是innodb完整支持外键



### 约束和索引的区别

约束是逻辑概念

索引除了逻辑概念，还有物理存储结构



数据库的存储结构，

表结构是frm文件存储

myisam的数据在myd里，索引放在myi里，是一个b+树的结构，叶子结点指向了myd里的数据（堆表结构），读取性能比较高



innodb将数据额和索引都存在ibd文件里

innodb由段，区，页组成，

段：

- 数据段
- 索引段
- 回滚段

区：大小1mb，一个区由64个连续页组成（为了保证连续，一般引擎一次申请4-5个区）

一个页默认为16k



聚集索引

以主键构造的b+树，叶子结点中存放数据页



辅助索引：不是主键构造的b+树，不包含行记录的所有数据，一般是根据辅助索引映射到主键值，然后再用聚集索引来找整行的数据。



覆盖索引，直接通过辅助索引获得数据，不需要通过聚集索引来找



组合索引符合最左匹配原则，

查询组合索引的次序可以不同，因为优化器会优化

但是不能中间缺省



某个字段既有单字段索引又有组合索引，优化器会选择组合索引



